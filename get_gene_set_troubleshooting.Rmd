---
title: "get_gene_set_troubleshooting"
output: html_document
---
# Follows from: "get_pairwise_zeb_ciona_degs.Rmd".
# Note: This exploratory script exists because only 6 1-1 DEG Orthologs were identified (implementation present at end).

# Works in parallel with: None.

# General Description: Script implements various methods to get gene set
# to be used for downstream cross-species cell type comparisons. 

# Uses env_get_pairwise_zeb_ciona_degs.RData

# Module v2: Wrong Implementation. Used "get_geneset_v2.py" (at end of Script)
# Important Observations: (at end of Script)
#   (1) Only Var Genes are used for DEG calculations and can be visualized. 
#   (2) zeb_integrated_50 and clean_chen_larva_integrated_20 have 2000.

# TO DO Segways into 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=TRUE}
library(Seurat)
```

```{r include=TRUE}
```


















"""
Old: Module v2 and Important Observations
"""

"""
Module v2: Do we get a signal if we use all orthologous genes? - WRONG IMPLEMENTATION
"""

# Question: Which 1-1 orthos are expressed in Ciona?
# Get KHID's for all orthos -WRONG
```{r include=TRUE}
all_khid_ortho_dir <- "/home/pprakriti/Git/Orthology-Maps/munging_code/all_khid_ortho_list.csv"

all_khid_ortho_df <- read.table(all_khid_ortho_dir,
                                sep = ",",
                                header = FALSE,
                                stringsAsFactors = FALSE)

all_khid_ortho_vec <- as.vector(all_khid_ortho_df$V1)
```

# Expression of 1-1 orthos in Ciona 
# Not all KHID orthos are expressed. -WRONG
```{r include=TRUE}
DoHeatmap(object = clean_chen_larva_integrated_20,
          features = all_khid_ortho_vec,
          cells = ciona_larva_noto,
          slot = "data",
          size = 2)
```

# Question: Which 1-1 orthos are expressed in Zeb?
# Get gene names of all orthos -WRONG
```{r include=TRUE}
all_zeb_gene_ortho_dir <- "/home/pprakriti/Git/Orthology-Maps/munging_code/all_zeb_gene_ortho_list.csv"

all_zeb_gene_ortho_df <- read.table(all_zeb_gene_ortho_dir,
                                sep = ",",
                                header = FALSE,
                                stringsAsFactors = FALSE)

all_zeb_gene_ortho_vec <- as.vector(all_zeb_gene_ortho_df$V1)
```

# Expression of 1-1 orthos in Zeb 
# Not all orthos are expressed. -WRONG
```{r include=TRUE}
# Note: there is a vector called zeb_ortho_gene_vec- the 6 DEGs in common
DoHeatmap(object = zeb_integrated_50,
          features = all_zeb_gene_ortho_vec,
          cells = noto,
          slot = "data",
          size = 2)
```

# How many 1-1 orthologs are expressed in each?
# I am looking at the intersection between the 2993 orthologs and the 2000 Var Features of each. -WRONG
```{r include=TRUE}
# 141
test_ciona_var_feats <- clean_chen_larva_integrated_20@assays$integrated@var.features
test_one_one_var_feats_ciona <- intersect(test_ciona_var_feats, all_khid_ortho_vec)

# 83
test_zeb_var_feats <- zeb_integrated_50@assays$integrated@var.features
test_one_one_var_feats_zeb <- intersect(test_zeb_var_feats, all_zeb_gene_ortho_vec)
```

# Now we want to know which 1-1 orthologs are expressed in both
# Write out 1-1 zeb gene orthologs (83)... -WRONG
```{r include=TRUE}
# This goes to my Git directory...
write.csv(x = test_one_one_var_feats_zeb,
          file = "test_one_one_var_feats_zeb.csv",
          row.names = FALSE)

```

# ... and get their KHIDs -WRONG
```{r include=TRUE}
# This is coming from scratch Desktop
khid_ortho_list_dir <- "/home/pprakriti/Desktop/temp_ortho/scratch_khid_ortho_list.csv"


khid_ortho_df <- read.table(khid_ortho_list_dir,
                                sep = ",",
                                header = FALSE,
                                stringsAsFactors = FALSE)

khid_ortho_vec <- as.vector(khid_ortho_df$V1)
```

# How many of these zeb orthologs (translated into KHIDs) are in expressed in Ciona? -WRONG
```{r include=TRUE}
# 25 :/ 
test_yes_khid <- intersect(test_ciona_var_feats, khid_ortho_vec)
```

# This is what the (25) profile looks like in Ciona. -WRONG
```{r include=TRUE}
DoHeatmap(object = clean_chen_larva_integrated_20,
          features = test_yes_khid,
          cells = ciona_larva_noto,
          slot = "data",
          size = 2)
```

# Take these KHIDs -> ENSC -> ENSD -> gene name -> visualize here. -WRONG
```{r include=TRUE}
write.csv(x = test_yes_khid,
          file = "test_yes_khid.csv",
          row.names = FALSE)
```

# These are the translated zeb gene names of above -WRONG
```{r include=TRUE}
zeb_25_ortho_list_dir <- "/home/pprakriti/Desktop/temp_ortho/scratch_25_zeb_gene_list.csv"


zeb_25_ortho_df <- read.table(zeb_25_ortho_list_dir,
                                sep = ",",
                                header = FALSE,
                                stringsAsFactors = FALSE)

zeb_25_ortho_vec <- as.vector(zeb_25_ortho_df$V1)
```

# This is what it looks like in Zeb -WRONG
```{r include=TRUE}
# Note: there is a vector called zeb_ortho_gene_vec- the 6 DEGs in common
DoHeatmap(object = zeb_integrated_50,
          features = zeb_25_ortho_vec,
          cells = noto,
          slot = "data",
          size = 2)
```

# Quick and dirty validation that the 25 genes are the same.
# They are not! Also the KHIDs are not 1-1 orthologs! 
```{r include=TRUE}

write.csv(x = test_yes_khid,
          file = "~/Desktop/test_yes_khid.csv",
          row.names = FALSE)
```

"""
Exploratory Questions
"""
# I want to get genes that aren't Var Genes- are they expressed in Ciona?

# Are all markers present in Var Genes? Try for notochord.
```{r include=TRUE}
test_noto_marker_df <- FindMarkers(clean_chen_larva_integrated_20,
                                 ident.1 = ciona_larva_noto) 
```

```{r include=TRUE}
# 762
test_noto_markers <- rownames(test_noto_marker_df)
test_ciona_var_genes <- clean_chen_larva_integrated_20@assays$integrated@var.features
```

# Conclusion: All markers are present in Var Genes. 
```{r include=TRUE}
# 762
test_intersect <- intersect(test_noto_markers, test_ciona_var_genes)
length(test_intersect == test_noto_markers)
```

# How about genes in data matrix? (14433)
```{r include=TRUE}
test_all_ciona_genes <- clean_chen_larva_integrated_20@assays$RNA@data@Dimnames[[1]]

# 12433
test_not_var_genes <- setdiff(test_all_ciona_genes, test_ciona_var_genes)
```

# Let's take the first 10 of these genes and check for expression.
```{r include=TRUE}
test_10_not_var_genes <- test_not_var_genes[1:10]
```

# These genes do not show up in 
```{r include=TRUE}
DoHeatmap(object = clean_chen_larva_integrated_20,
          features = test_10_not_var_genes,
          cells = ciona_larva_noto,
          slot = "data")
```




"""
TO DO
"""

# (Zeb) Are any of these in top50 DEGs for Zeb Noto?
```{r include=TRUE}
# No :(
zeb_true_vec <- zeb_ortho_gene_vec %in% ciona_noto_top50_markers
```


